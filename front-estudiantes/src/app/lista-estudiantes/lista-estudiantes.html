<div class="lista-container">
  <h1>Lista de Estudiantes</h1>
  <button class="btn-new" (click)="abrirFormulario()">Nuevo Estudiante</button>

  <p *ngIf="loading">Cargando estudiantes...</p>
  <p *ngIf="error" class="error">{{ error }}</p>

  <table *ngIf="!loading && estudiantes.length > 0">
    <thead>
      <tr>
        <th>ID</th>
        <th>Nombre</th>
        <th>Email</th>
        <th>Carrera</th>
        <th>Semestre</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let e of estudiantes">
        <td>{{ e.id }}</td>
        <td>{{ e.nombre }}</td>
        <td>{{ e.email }}</td>
        <td>{{ e.carrera }}</td>
        <td>{{ e.semestre }}</td>
        <td>
          <button class="btn-edit" (click)="abrirFormulario(e)">Editar</button>
          <button class="btn-delete" (click)="eliminar(e.id)">Eliminar</button>
        </td>
      </tr>
    </tbody>
  </table>

  <p *ngIf="!loading && estudiantes.length === 0">No hay estudiantes registrados.</p>

  <!-- FORMULARIO SIMPLE -->
  <div class="modal" *ngIf="showForm">
    <div class="modal-content">
      <h2>{{ editMode ? 'Editar Estudiante' : 'Nuevo Estudiante' }}</h2>
      <form #f="ngForm" (ngSubmit)="guardar(f)">
        <label>Nombre</label>
        <input 
          [(ngModel)]="selected.nombre" 
          name="nombre" 
          required
          minlength="3"
          pattern="^[a-zA-ZÀ-ÿ\s]+$"
          #nombre="ngModel"
        />
        <div class="error-msg"
            *ngIf="nombre.invalid && (nombre.touched || nombre.dirty)">
          
          <span *ngIf="nombre.errors?.['required']">El nombre es obligatorio.</span>
          <span *ngIf="nombre.errors?.['minlength']">El nombre es muy corto.</span>
          <span *ngIf="nombre.errors?.['pattern']">Solo se permiten letras.</span>
        </div>

        <label>Email</label>
        <input 
          [(ngModel)]="selected.email" 
          name="email" 
          type="email" 
          required
          pattern="^[^\s@]+@[^\s@]+\.[^\s@]+$"
          #email="ngModel"
        />
        <div class="error-msg"
            *ngIf="email.invalid && (email.touched || email.dirty)">
          Ingresa un correo válido. Ej: usuario@correo.com
        </div>
        <div class="error-msg" *ngIf="correoDuplicado">
          Este correo ya está registrado.
        </div>

        <label>Carrera</label>
        <input 
          [(ngModel)]="selected.carrera" 
          name="carrera" 
          required
          minlength="3"
          pattern="^[a-zA-ZÀ-ÿ\s]+$" 
          #carrera="ngModel"
        />
        <div class="error-msg"
            *ngIf="carrera.invalid && (carrera.touched || carrera.dirty)">
          
          <span *ngIf="carrera.errors?.['required']">La carrera es obligatoria.</span>
          <span *ngIf="carrera.errors?.['minlength']">Debe tener al menos 3 caracteres.</span>
          <span *ngIf="carrera.errors?.['pattern']">Solo se permiten letras.</span>
        </div>

        <label>Semestre</label>
        <input 
          [(ngModel)]="selected.semestre" 
          name="semestre" 
          type="number" 
          required
          min="1" 
          max="14"
          #semestre="ngModel"
        />
        <div class="error-msg"
            *ngIf="semestre.invalid && (semestre.touched || semestre.dirty)">
          
          <span *ngIf="semestre.errors?.['required']">El semestre es obligatorio.</span>
          <span *ngIf="semestre.errors?.['min']">Debe ser mínimo 1.</span>
          <span *ngIf="semestre.errors?.['max']">No puede ser mayor a 12.</span>
        </div>

        <div class="modal-buttons">
          <button 
            type="submit" 
            class="btn-save"
            [disabled]="f.invalid"
            novalidate
          >
            {{ editMode ? 'Actualizar' : 'Crear' }}
          </button>
          <button type="button" class="btn-cancel" (click)="cerrarFormulario()">Cancelar</button>
        </div>
      </form>
    </div>
  </div>
</div>